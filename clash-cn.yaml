# Copyright (C) 2023 demarcush
# License: AGPL-3.0-or-later (https://www.gnu.org/licenses/agpl.txt)
# Repository: https://github.com/demarcush/breakfree
## Software: Clash
## Country: China

mixed-port: 7890
allow-lan: true
mode: rule
log-level: error ## silent/error/warning/info/debug
ipv6: true
external-controller: '127.0.0.1:9090'
profile:
  store-selected: false ## It's best to default to "auto" every time it restarts.
  store-fake-ip: true

#tun:
  #enable: true
  #stack: gvisor ## system/gvisor
  #dns-hijack:
    #- 'any:53'
    #- "tcp://any:53"
  #auto-route: true
  #auto-detect-interface: true

dns:
  enable: true
  #listen: '127.0.0.1:53' ## Or 0.0.0.0:53 for LAN.
  ipv6: true
  enhanced-mode: fake-ip
  use-hosts: true
  nameserver:
    - "https://1.0.0.1/dns-query"
    - "https://8.8.4.4/dns-query"
    - "https://149.112.112.112/dns-query"
  nameserver-policy:
    "+.cn,+.citic,+.baidu,+.unicom,+.sohu,+.xn--fiqs8s,+.xn--fiqz9s,+.xn--1qqw23a,+.xn--xhq521b,+.xn--8y0a063a,+.xn--6frz82g,+.xn--fiq64b,+.xn--estv75g,+.xn--vuq861b,+.xn--zfr164b": "https://223.5.5.5/dns-query"
  fallback-filter:
    geoip: false

proxy-groups:

- name: default
  type: select
  proxies:
    - auto
    - manual
    - DIRECT
    - REJECT

- name: manual
  type: select
  use:
    #- local
    - yebekhe
    - aggregator

- name: auto
  type: url-test
  #tolerance: 300
  #filter: "üèÅ|üö©"
  use:
    #- local
    - yebekhe
    - aggregator

proxy-providers:

  #local:
    #type: file
    #path: ./providers/local.yaml ## << Put your custom servers here.
    #health-check:
      #enable: true
      #interval: 10800
      #lazy: true
      ##url: "https://cp.cloudflare.com"
      ##url: "https://detectportal.firefox.com/success.txt"
      #url: "https://www.google.com/robots.txt"

  aggregator:
    type: http
    #url: "https://raw.githubusercontent.com/mahdibland/V2RayAggregator/master/sub/sub_merge_yaml.yml"
    #url: "https://cdn.jsdelivr.net/gh/mahdibland/V2RayAggregator@master/sub/sub_merge_yaml.yml"
    #url: "https://cdn.statically.io/gh/mahdibland/V2RayAggregator@master/sub/sub_merge_yaml.yml"
    url: "https://yebekhe.link/api/toClash/?url=https://raw.githubusercontent.com/mahdibland/V2RayAggregator/master/sub/sub_merge_base64.txt&type=clash&process=full"
    interval: 86400
    path: ./providers/aggregator.yaml
    health-check:
      enable: true
      interval: 10800
      lazy: true
      #url: "https://cp.cloudflare.com"
      #url: "https://detectportal.firefox.com/success.txt"
      url: "https://www.google.com/robots.txt"

  yebekhe:
    type: http
    url: "https://yebekhe.link/api/toClash/?url=https://raw.githubusercontent.com/yebekhe/TelegramV2rayCollector/main/sub/base64/mix&type=clash&process=full"
    #url: "https://api.sublink.dev/sub?target=clash&url=https://raw.githubusercontent.com/yebekhe/TelegramV2rayCollector/main/sub/base64/mix&emoji=false&list=true&fdn=true"
    interval: 86400
    path: ./providers/yebekhe.yaml
    health-check:
      enable: true
      interval: 10800
      lazy: true
      #url: "https://cp.cloudflare.com"
      #url: "https://detectportal.firefox.com/success.txt"
      url: "https://www.google.com/robots.txt"

rules:
  - GEOIP,private,DIRECT,no-resolve ## Loopback and LAN IPs

  - DOMAIN-SUFFIX,cn,DIRECT
  - DOMAIN-SUFFIX,citic,DIRECT
  - DOMAIN-SUFFIX,baidu,DIRECT
  - DOMAIN-SUFFIX,unicom,DIRECT
  - DOMAIN-SUFFIX,sohu,DIRECT
  - DOMAIN-SUFFIX,xn--fiqs8s,DIRECT
  - DOMAIN-SUFFIX,xn--fiqz9s,DIRECT
  - DOMAIN-SUFFIX,xn--1qqw23a,DIRECT
  - DOMAIN-SUFFIX,xn--xhq521b,DIRECT
  - DOMAIN-SUFFIX,xn--8y0a063a,DIRECT
  - DOMAIN-SUFFIX,xn--6frz82g,DIRECT
  - DOMAIN-SUFFIX,xn--fiq64b,DIRECT
  - DOMAIN-SUFFIX,xn--estv75g,DIRECT
  - DOMAIN-SUFFIX,xn--vuq861b,DIRECT
  - DOMAIN-SUFFIX,xn--zfr164b,DIRECT

  - DOMAIN-SUFFIX,yacd.haishan.me,DIRECT ## Yet Another Clash Dashboard

  - GEOIP,cn,DIRECT
  - MATCH,default
